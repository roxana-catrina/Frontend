<div class="reset-password-container">
  <div class="reset-password-card shadow-lg">
    <div class="card-header text-center">
      <i class="bi bi-shield-lock-fill icon-large"></i>
      <h2 class="mt-3">Resetare Parolă</h2>
      <p class="text-muted">Introdu codul primit pe email și noua parolă</p>
    </div>

    <div class="card-body">
      <!-- Alert Messages -->
      <div *ngIf="message" 
           class="alert" 
           [ngClass]="messageType === 'success' ? 'alert-success' : 'alert-danger'"
           role="alert">
        <i class="bi" [ngClass]="messageType === 'success' ? 'bi-check-circle' : 'bi-exclamation-circle'"></i>
        {{ message }}
      </div>

      <!-- Email Display -->
      <div class="email-display mb-4">
        <i class="bi bi-envelope-fill"></i>
        <span>{{ email }}</span>
      </div>

      <form [formGroup]="resetPasswordForm" (ngSubmit)="resetPassword()">
        <!-- Verification Code -->
        <div class="mb-4">
          <label for="code" class="form-label">
            <i class="bi bi-key"></i> Cod de Verificare
          </label>
          <input type="text" 
                 id="code" 
                 class="form-control form-control-lg text-center code-input" 
                 formControlName="code"
                 placeholder="000000"
                 maxlength="6"
                 [class.is-invalid]="resetPasswordForm.get('code')?.invalid && resetPasswordForm.get('code')?.touched">
          
          <div *ngIf="resetPasswordForm.get('code')?.invalid && resetPasswordForm.get('code')?.touched" 
               class="invalid-feedback">
            <small *ngIf="resetPasswordForm.get('code')?.errors?.['required']">
              Codul este obligatoriu
            </small>
            <small *ngIf="resetPasswordForm.get('code')?.errors?.['pattern']">
              Codul trebuie să conțină exact 6 cifre
            </small>
          </div>

          <div class="text-center mt-2">
            <button type="button" 
                    class="btn btn-link btn-sm" 
                    (click)="resendCode()">
              <i class="bi bi-arrow-clockwise"></i> Retrimite codul
            </button>
          </div>
        </div>

        <!-- New Password -->
        <div class="mb-4">
          <label for="newPassword" class="form-label">
            <i class="bi bi-lock"></i> Parola Nouă
          </label>
          <div class="password-input-group">
            <input [type]="showPassword ? 'text' : 'password'" 
                   id="newPassword" 
                   class="form-control form-control-lg" 
                   formControlName="newPassword"
                   placeholder="Minim 6 caractere"
                   [class.is-invalid]="resetPasswordForm.get('newPassword')?.invalid && resetPasswordForm.get('newPassword')?.touched">
            <button type="button" 
                    class="btn-toggle-password" 
                    (click)="togglePasswordVisibility('password')">
              <i class="bi" [ngClass]="showPassword ? 'bi-eye-slash' : 'bi-eye'"></i>
            </button>
          </div>
          
          <div *ngIf="resetPasswordForm.get('newPassword')?.invalid && resetPasswordForm.get('newPassword')?.touched" 
               class="invalid-feedback d-block">
            <small *ngIf="resetPasswordForm.get('newPassword')?.errors?.['required']">
              Parola este obligatorie
            </small>
            <small *ngIf="resetPasswordForm.get('newPassword')?.errors?.['minlength']">
              Parola trebuie să aibă minim 6 caractere
            </small>
          </div>
        </div>

        <!-- Confirm Password -->
        <div class="mb-4">
          <label for="confirmPassword" class="form-label">
            <i class="bi bi-lock-fill"></i> Confirmă Parola
          </label>
          <div class="password-input-group">
            <input [type]="showConfirmPassword ? 'text' : 'password'" 
                   id="confirmPassword" 
                   class="form-control form-control-lg" 
                   formControlName="confirmPassword"
                   placeholder="Re-introdu parola"
                   [class.is-invalid]="resetPasswordForm.get('confirmPassword')?.invalid && resetPasswordForm.get('confirmPassword')?.touched">
            <button type="button" 
                    class="btn-toggle-password" 
                    (click)="togglePasswordVisibility('confirm')">
              <i class="bi" [ngClass]="showConfirmPassword ? 'bi-eye-slash' : 'bi-eye'"></i>
            </button>
          </div>
          
          <div *ngIf="resetPasswordForm.get('confirmPassword')?.errors?.['passwordMismatch'] && resetPasswordForm.get('confirmPassword')?.touched" 
               class="invalid-feedback d-block">
            <small>Parolele nu coincid</small>
          </div>
        </div>

        <button type="submit" 
                class="btn btn-primary btn-lg w-100 mb-3"
                [disabled]="resetPasswordForm.invalid || isSubmitting">
          <span *ngIf="!isSubmitting">
            <i class="bi bi-check-circle"></i> Resetează Parola
          </span>
          <span *ngIf="isSubmitting">
            <span class="spinner-border spinner-border-sm me-2"></span>
            Se procesează...
          </span>
        </button>

        <div class="text-center">
          <button type="button" 
                  class="btn btn-link" 
                  (click)="goToLogin()">
            <i class="bi bi-arrow-left"></i> Înapoi la Autentificare
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
